# This is a Spack Environment file for developing CP2K
spack:
  specs:
    - cp2k@master +libxc +spglib ~libint build_system=cmake
  packages:
    all:
      require:
        - any_of: ["+mpi", "@:"]
    # Set virtual providers
    mpi:
      require:
        - "@4"
    blas:
      require:
        - openblas 
    lapack:
      require:
        - openblas
    scalapack:
      require:
        - netlib-scalapack
    fftw-api:
      require:
        - "@3"
        - fftw
    # Package requirements
    openblas:
      require:
        - "@0.3.24"
        - "+fortran"
        - "threads=openmp"
    netlib-scalapack:
      # ScaLAPACK 2.2.1 has not yet been packaged by Spack.
      # https://github.com/Reference-ScaLAPACK/scalapack/tree/v2.2.1
      # which contains https://github.com/Reference-ScaLAPACK/scalapack/pull/26
      require:
        - "@2.2.0"
    fftw:
      require:
        - "@3.3.10"
    dbcsr:
      require:
        - "@2.6.0"
    libxsmm:
      require:
        - "@1.17"
    libxc:
      require:
        - "@6.2.2"
    spglib:
      require:
        - "@1.16.2"
    cmake:
      require:
        - "@3.22:"
   # TODO:
   # - "libint @2.6.0 +fortran tune=cp2k-lmax-5" # build takes 16 min
   # - "sirius @7.4.3 +fortran +shared +openmp" # build fails
   # - "plumed @2.9.0 +shared +mpi optional_modules=all" # requires cython
   # - "libvori @220621" # is not recompile with -fPIC
   # - "cosma @2.6.6"
   # - "elpa @2023.05.001 +openmp"
   #
   # scotch_6.0.0.tar.gz
   # superlu_dist_6.1.0.tar.gz: OK
   # pexsi_v1.2.0.tar.gz: OK
   # QUIP-0.9.10.tar.gz
   # hdf5-1.14.2.tar.bz2: OK
   # libvdwxc-0.4.0.tar.gz: OK
   # libtorch-cxx11-abi-shared-with-deps-1.12.1+cpu.zip: OK
   # SpLA-1.5.5.tar.gz: OK
  view: true
  concretizer:
    unify: true
#EOF
